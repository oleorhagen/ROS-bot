<?xml version="1.0"?>
<robot name="r2d2" xmlns:xacro="http://www.ros.org/wiki/xacro"  >


  <xacro:property name="body_mass" value="2.0" />

  <xacro:property name="chassis_xsize" value="1.0" />
  <xacro:property name="chassis_ysize" value="0.5" />
  <xacro:property name="chassis_zsize" value="0.3" />

  <xacro:property name="axel_zpos" value="0" />
  <xacro:property name="axel_width" value="${chassis_ysize*1.5}" />
  <xacro:property name="front_axel_xpos" value="${chassis_xsize/2 - wheel_radius/2}" />
  <xacro:property name="back_axel_xpos" value="${-chassis_xsize/2 + wheel_radius/2}" />

  <xacro:property name="wheel_radius" value="0.2" />
  <xacro:property name="wheel_width" value="0.2" />

  <material name="black">
    <color rgba="0.0 0.0 0.0 1.0" />
  </material>

  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0" />
  </material>

  <material name="red">
    <color rgba="1.0 0.0 0.0 1.0" />
  </material>

  <material name="green">
    <color rgba="0.0 1.0 0.0 1.0" />
  </material>

  <material name="blue">
    <color rgba="0.0 0.0 1.0 1.0" />
  </material>

  <material name="yellow">
    <color rgba="1.0 1.0 0.0 1.0" />
  </material>

  <xacro:macro name="box_inertia" params="mass length width height x:=0 y:=0 z:=0 roll:=0 pitch:=0 yaw:=0" >
    <inertial>
      <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}" />
      <mass value="${mass}" />
      <inertia ixx="${mass / 12.0 * (width * width + height * height)}"     ixy="0.0"   ixz="0.0" iyy="${mass / 12.0 * (length * length + height * height)}" iyz="0.0" izz="${mass / 12.0 * (length * length + width * width)}" />
    </inertial>
  </xacro:macro>

  <xacro:macro name="cylinder_inertia" params="mass length radius x:=0 y:=0 z:=0 roll:=0 pitch:=0 yaw:=0" >
    <inertial>
      <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}" />
      <mass value="${mass}"/>
      <inertia
          ixx="${mass / 12.0 * (3 * radius * radius + length * length)}" ixy="0.0" ixz="0.0"
          iyy="${mass / 12.0 * (3 * radius * radius + length * length)}" iyz="0.0"
          izz="${mass / 2.0 * (radius * radius)}"/>
  </inertial>  </xacro:macro>

  <xacro:macro name="custom_box" params="link_name color:=black size_x size_y size_z x:=0 y:=0 z:=0 roll:=0 pitch:=0 yaw:=0 joint_name parent_link child_link link_type:=fixed" >
    <link name="${link_name}">
      <visual>
        <material name="${color}" />
        <geometry>
          <box size="${size_x} ${size_y} ${size_z}" />
        </geometry>
      </visual>
      <collision>
        <geometry>
          <box size="${size_x} ${size_y} ${size_z}" />
        </geometry>
      </collision>
      <xacro:box_inertia mass="${body_mass}" length="${size_x}" width="${size_y}" height="${size_z}" x="${x}" y="${y}" z="${z}" roll="${roll}" pitch="${pitch}" yaw="${yaw}" />
    </link>
    <joint name="${joint_name}" type="${link_type}">
      <parent link="${parent_link}" />
      <child link="${child_link}" />
    </joint>
  </xacro:macro>

  <xacro:macro name="custom_cylinder" params="link_name color mass length radius x:=0 y:=0 z:=0 roll:=0 pitch:=0 yaw:=0" >
    <link name="${link_name}">
      <visual>
        <material name="${color}"/>
        <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}" />
        <geometry>
          <cylinder length="${length}" radius="${radius}" />
        </geometry>
      </visual>
      <collision>
        <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}" />
        <cylinder length="${length}" radius="${radius}" />
        <geometry>
          <cylinder length="${length}" radius="${radius}" />
        </geometry>
      </collision>
      <xacro:cylinder_inertia mass="${body_mass}" length="${length}" radius="${radius}" y="${y}" z="${z}" roll="${roll}" pitch="${pitch}" yaw="${yaw}" />
      </link>
  </xacro:macro>

  <!-- Not used yet -->

  <link name="base_link" />

  <xacro:custom_box link_name="chassis" size_x="${chassis_xsize}" size_y="${chassis_ysize}" size_z="${chassis_zsize}" joint_name="joint_chassis_to_base" parent_link="base_link" child_link="chassis" />

  <xacro:custom_cylinder link_name="front_steer_bar" color="yellow" mass="0.1" length="0.1" radius="0.01" roll="${pi/2}" yaw="${pi/2}" />

  <joint name="joint_front_steer_bar" type="revolute">
    <origin xyz="${front_axel_xpos} 0 ${axel_zpos}" />
    <parent link="chassis" />
    <child link="front_steer_bar" />
    <limit lower="-0.3" upper="0.3" effort="100" velocity="10" />
    <axis xyz="0 0 1" />
  </joint>


  <xacro:custom_cylinder link_name="front_wheel" color="yellow" mass="0.1" length="0.05" radius="0.05" roll="${pi/2}" />

  <joint name="joint_front_wheel" type="continuous">
    <parent link="front_steer_bar" />
    <child link="front_wheel" />
    <axis xyz="0 1 0"/>
    <!-- The front-wheels should not produce any torque whatsoever -->
    <limit lower="-0.3" upper="0.3" effort="0.0" velocity="10" />
  </joint>


  <xacro:custom_cylinder link_name="left_back_wheel" color="red" mass="0.1" length="${wheel_width}" radius="${wheel_radius}" roll="${pi/2}" />

  <joint name="joint_left_back_wheel" type="continuous">
    <parent link="chassis" />
    <child link="left_back_wheel" />
    <origin xyz="${back_axel_xpos} ${axel_width/2} ${axel_zpos}" />
    <axis xyz="0 1 0"/>
    <limit lower="-0.3" upper="0.3" effort="100" velocity="10" />
  </joint>


  <xacro:custom_cylinder link_name="right_back_wheel" color="red" mass="0.1" length="${wheel_width}" radius="${wheel_radius}" roll="${pi/2}" />

  <joint name="joint_right_back_wheel" type="continuous">
    <mimic joint="joint_left_back_wheel" />
    <parent link="chassis" />
    <child link="right_back_wheel" />
    <origin xyz="${back_axel_xpos} ${-axel_width/2} ${axel_zpos}" />
    <axis xyz="0 1 0"/>
    <limit lower="-0.3" upper="0.3" effort="100" velocity="10" />
  </joint>


  <xacro:custom_cylinder link_name="left_front_steer_bar" color="yellow" mass="0.1" length="0.1" radius="0.01" roll="${pi/2}" yaw="${pi/2}" />

  <joint name="joint_left_front_steer_bar" type="revolute">
    <origin xyz="${front_axel_xpos} ${axel_width/2} ${axel_zpos}" />
    <parent link="chassis" />
    <child link="left_front_steer_bar" />
    <limit lower="-0.3" upper="0.3" effort="100" velocity="10" />
    <axis xyz="0 0 1" />
  </joint>


  <xacro:custom_cylinder link_name="left_front_wheel" color="red" mass="0.1" length="${wheel_width}" radius="${wheel_radius}" roll="${pi/2}" />

  <joint name="joint_left_front_wheel" type="continuous">
    <parent link="left_front_steer_bar" />
    <child link="left_front_wheel" />
    <!-- <origin xyz="${front_axel_xpos} ${-axel_width/2} ${axel_zpos}" /> -->
    <axis xyz="0 1 0"/>
    <limit lower="-0.3" upper="0.3" effort="0" velocity="10" />
  </joint>


  <xacro:custom_cylinder link_name="right_front_steer_bar" color="yellow" mass="0.1" length="0.1" radius="0.01" roll="${pi/2}" yaw="${pi/2}" />

  <joint name="joint_right_front_steer_bar" type="revolute">
    <origin xyz="${front_axel_xpos} ${-axel_width/2} ${axel_zpos}" />
    <parent link="chassis" />
    <child link="right_front_steer_bar" />
    <limit lower="-0.3" upper="0.3" effort="100" velocity="10" />
    <axis xyz="0 0 1" />
  </joint>



  <xacro:custom_cylinder link_name="right_front_wheel" color="red" mass="0.1" length="${wheel_width}" radius="${wheel_radius}" roll="${pi/2}" />

  <joint name="joint_right_front_wheel" type="continuous">
    <parent link="right_front_steer_bar" />
    <child link="right_front_wheel" />
    <axis xyz="0 1 0"/>
    <limit lower="-0.3" upper="0.3" effort="0" velocity="10" />
  </joint>




  <!-- -\-\-\- -->
  <!-- Sensors -->
  <!-- -\-\-\- -->

  <!-- Camera -->
  <link name="camera_box" >
    <visual>
      <material name="blue" />
      <geometry>
        <box size="0.05 0.05 0.05" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.05 0.05 0.05" />
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1" />
      <inertia ixx="${(1/12)*0.1*(3*0.05*0.05 + 0.05*0.05)}"     ixy="0.0"   ixz="0.0" iyy="${(1/12)*0.1*(3*0.05*0.05 + 0.05*0.05)}" iyz="0.0" izz="${(1/12)*0.1*(0.05*0.05)}" />
    </inertial>
  </link>

  <joint name="joint_camera_box" type="fixed">
    <origin xyz="0.5 0.0 0" rpy="0 0 0" />
    <parent link="chassis" />
    <child link="camera_box" />
  </joint>

  <!-- Lidar -->
  <link name="lidar_cylinder">
    <visual>
      <!-- <origin xyz="0 0 0.15" /> -->
      <material name="green" />
      <geometry>
        <cylinder length="0.2" radius="0.1" />
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" />
      <geometry>
        <cylinder length="0.2" radius="0.1" />
      </geometry>
    </collision>
    <inertial>
      <mass value="0.2" />
      <inertia ixx="${(1/12)*0.2*(3*0.1*0.1 + 0.1*0.1)}"     ixy="0.0"   ixz="0.0" iyy="${(1/12)*0.2*(3*0.1*0.1 + 0.1*0.1)}" iyz="0.0" izz="${(1/12)*0.2*(0.1*0.1)}" />
    </inertial>
  </link>

  <joint name="joint_lidar_cylinder" type="fixed">
    <origin xyz="0 0 0.3" />
    <parent link="chassis" />
    <child link="lidar_cylinder" />
  </joint>

</robot>
